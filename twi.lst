   1               		.file	"twi.c"
   2               	__SP_H__ = 0x3e
   3               	__SP_L__ = 0x3d
   4               	__SREG__ = 0x3f
   5               	__tmp_reg__ = 0
   6               	__zero_reg__ = 1
   7               		.text
   8               	.Ltext0:
   9               		.cfi_sections	.debug_frame
  10               	.global	twi_init
  12               	twi_init:
  13               	.LFB7:
  14               		.file 1 "twi.c"
   1:twi.c         **** #include "twi.h"
   2:twi.c         **** #include <avr/io.h>
   3:twi.c         **** #include <stdio.h>
   4:twi.c         **** #include <util/delay.h>
   5:twi.c         **** 
   6:twi.c         **** void twi_init(void) {
  15               		.loc 1 6 0
  16               		.cfi_startproc
  17               	/* prologue: function */
  18               	/* frame size = 0 */
  19               	/* stack size = 0 */
  20               	.L__stack_usage = 0
   7:twi.c         ****     PORTC |= (1<<4) | (1<<5); //Enable pullups on SDA and SCL pins
  21               		.loc 1 7 0
  22 0000 88B1      		in r24,0x8
  23 0002 8063      		ori r24,lo8(48)
  24 0004 88B9      		out 0x8,r24
   8:twi.c         ****     TWBR = ((F_CPU)/(TWI_FREQ)-16)/2;
  25               		.loc 1 8 0
  26 0006 88E4      		ldi r24,lo8(72)
  27 0008 8093 B800 		sts 184,r24
   9:twi.c         ****     TWSR = 0; //Set prescaler to 1
  28               		.loc 1 9 0
  29 000c 1092 B900 		sts 185,__zero_reg__
  10:twi.c         ****     TWCR = (1<<TWEN) | (1<<TWEA); //Enable TWI
  30               		.loc 1 10 0
  31 0010 84E4      		ldi r24,lo8(68)
  32 0012 8093 BC00 		sts 188,r24
  33 0016 0895      		ret
  34               		.cfi_endproc
  35               	.LFE7:
  37               	.global	twi_start
  39               	twi_start:
  40               	.LFB8:
  11:twi.c         **** }
  12:twi.c         **** 
  13:twi.c         **** void twi_start(void) {
  41               		.loc 1 13 0
  42               		.cfi_startproc
  43               	/* prologue: function */
  44               	/* frame size = 0 */
  45               	/* stack size = 0 */
  46               	.L__stack_usage = 0
  14:twi.c         ****     TWCR = (1<<TWINT)|(1<<TWSTA)|(1<<TWEN);
  47               		.loc 1 14 0
  48 0018 84EA      		ldi r24,lo8(-92)
  49 001a 8093 BC00 		sts 188,r24
  50               	.L4:
  15:twi.c         ****     while ((TWCR & (1<<TWINT)) == 0);
  51               		.loc 1 15 0 discriminator 1
  52 001e 8091 BC00 		lds r24,188
  53 0022 87FF      		sbrs r24,7
  54 0024 00C0      		rjmp .L4
  55               	/* epilogue start */
  16:twi.c         **** }
  56               		.loc 1 16 0
  57 0026 0895      		ret
  58               		.cfi_endproc
  59               	.LFE8:
  61               	.global	twi_stop
  63               	twi_stop:
  64               	.LFB9:
  17:twi.c         **** 
  18:twi.c         **** void twi_stop(void) {
  65               		.loc 1 18 0
  66               		.cfi_startproc
  67               	/* prologue: function */
  68               	/* frame size = 0 */
  69               	/* stack size = 0 */
  70               	.L__stack_usage = 0
  19:twi.c         ****     TWCR = (1<<TWINT)|(1<<TWSTO)|(1<<TWEN)|(1<<TWEA);
  71               		.loc 1 19 0
  72 0028 84ED      		ldi r24,lo8(-44)
  73 002a 8093 BC00 		sts 188,r24
  74               	.L8:
  20:twi.c         ****     while(TWCR & (1<<TWSTO));
  75               		.loc 1 20 0 discriminator 1
  76 002e 8091 BC00 		lds r24,188
  77 0032 84FD      		sbrc r24,4
  78 0034 00C0      		rjmp .L8
  79               	/* epilogue start */
  21:twi.c         **** }
  80               		.loc 1 21 0
  81 0036 0895      		ret
  82               		.cfi_endproc
  83               	.LFE9:
  85               	.global	twi_write
  87               	twi_write:
  88               	.LFB10:
  22:twi.c         **** 
  23:twi.c         **** void twi_write(uint8_t data) {
  89               		.loc 1 23 0
  90               		.cfi_startproc
  91               	.LVL0:
  92               	/* prologue: function */
  93               	/* frame size = 0 */
  94               	/* stack size = 0 */
  95               	.L__stack_usage = 0
  24:twi.c         ****     TWDR = data;
  96               		.loc 1 24 0
  97 0038 8093 BB00 		sts 187,r24
  25:twi.c         ****     TWCR = (1<<TWINT)|(1<<TWEN);
  98               		.loc 1 25 0
  99 003c 84E8      		ldi r24,lo8(-124)
 100               	.LVL1:
 101 003e 8093 BC00 		sts 188,r24
 102               	.LVL2:
 103               	.L11:
  26:twi.c         ****     while ((TWCR & (1<<TWINT)) == 0);
 104               		.loc 1 26 0 discriminator 1
 105 0042 8091 BC00 		lds r24,188
 106 0046 87FF      		sbrs r24,7
 107 0048 00C0      		rjmp .L11
 108               	/* epilogue start */
  27:twi.c         **** }
 109               		.loc 1 27 0
 110 004a 0895      		ret
 111               		.cfi_endproc
 112               	.LFE10:
 114               	.global	twi_read
 116               	twi_read:
 117               	.LFB11:
  28:twi.c         **** 
  29:twi.c         **** uint8_t twi_read(uint8_t ack) {
 118               		.loc 1 29 0
 119               		.cfi_startproc
 120               	.LVL3:
 121               	/* prologue: function */
 122               	/* frame size = 0 */
 123               	/* stack size = 0 */
 124               	.L__stack_usage = 0
  30:twi.c         ****     if(ack==TWI_NACK) {
 125               		.loc 1 30 0
 126 004c 8111      		cpse r24,__zero_reg__
 127 004e 00C0      		rjmp .L13
  31:twi.c         ****         TWCR = (1<<TWINT)|(1<<TWEN);
 128               		.loc 1 31 0
 129 0050 84E8      		ldi r24,lo8(-124)
 130               	.LVL4:
 131 0052 00C0      		rjmp .L17
 132               	.LVL5:
 133               	.L13:
  32:twi.c         ****     } else {
  33:twi.c         ****         TWCR = (1<<TWINT)|(1<<TWEN) | (1<<TWEA);
 134               		.loc 1 33 0
 135 0054 84EC      		ldi r24,lo8(-60)
 136               	.LVL6:
 137               	.L17:
 138 0056 8093 BC00 		sts 188,r24
 139               	.L16:
  34:twi.c         ****     }
  35:twi.c         ****     while ((TWCR & (1<<TWINT)) == 0);
 140               		.loc 1 35 0 discriminator 1
 141 005a 8091 BC00 		lds r24,188
 142 005e 87FF      		sbrs r24,7
 143 0060 00C0      		rjmp .L16
  36:twi.c         ****     return TWDR;
 144               		.loc 1 36 0
 145 0062 8091 BB00 		lds r24,187
  37:twi.c         **** }
 146               		.loc 1 37 0
 147 0066 0895      		ret
 148               		.cfi_endproc
 149               	.LFE11:
 151               	.global	twi_status
 153               	twi_status:
 154               	.LFB12:
  38:twi.c         **** 
  39:twi.c         **** uint8_t twi_status(void) {
 155               		.loc 1 39 0
 156               		.cfi_startproc
 157               	/* prologue: function */
 158               	/* frame size = 0 */
 159               	/* stack size = 0 */
 160               	.L__stack_usage = 0
  40:twi.c         ****     uint8_t status;
  41:twi.c         ****     //mask status
  42:twi.c         ****     status = TWSR & 0xF8;
 161               		.loc 1 42 0
 162 0068 8091 B900 		lds r24,185
 163               	.LVL7:
  43:twi.c         ****     return status;
  44:twi.c         **** }
 164               		.loc 1 44 0
 165 006c 887F      		andi r24,lo8(-8)
 166               	.LVL8:
 167 006e 0895      		ret
 168               		.cfi_endproc
 169               	.LFE12:
 171               		.section	.rodata.str1.1,"aMS",@progbits,1
 172               	.LC0:
 173 0000 556E 6578 		.string	"Unexpected 1: %x\n"
 173      7065 6374 
 173      6564 2031 
 173      3A20 2578 
 173      0A00 
 174               	.LC1:
 175 0012 556E 6578 		.string	"Unexpected 2: %x\n"
 175      7065 6374 
 175      6564 2032 
 175      3A20 2578 
 175      0A00 
 176               	.LC2:
 177 0024 556E 6578 		.string	"Unexpected 3(%d): %x\n"
 177      7065 6374 
 177      6564 2033 
 177      2825 6429 
 177      3A20 2578 
 178               		.text
 179               	.global	twi_send
 181               	twi_send:
 182               	.LFB13:
  45:twi.c         **** 
  46:twi.c         **** uint8_t twi_send(uint8_t addr, uint8_t* data, uint8_t length, uint8_t repeat) {
 183               		.loc 1 46 0
 184               		.cfi_startproc
 185               	.LVL9:
 186 0070 AF92      		push r10
 187               	.LCFI0:
 188               		.cfi_def_cfa_offset 3
 189               		.cfi_offset 10, -2
 190 0072 BF92      		push r11
 191               	.LCFI1:
 192               		.cfi_def_cfa_offset 4
 193               		.cfi_offset 11, -3
 194 0074 DF92      		push r13
 195               	.LCFI2:
 196               		.cfi_def_cfa_offset 5
 197               		.cfi_offset 13, -4
 198 0076 EF92      		push r14
 199               	.LCFI3:
 200               		.cfi_def_cfa_offset 6
 201               		.cfi_offset 14, -5
 202 0078 FF92      		push r15
 203               	.LCFI4:
 204               		.cfi_def_cfa_offset 7
 205               		.cfi_offset 15, -6
 206 007a 0F93      		push r16
 207               	.LCFI5:
 208               		.cfi_def_cfa_offset 8
 209               		.cfi_offset 16, -7
 210 007c 1F93      		push r17
 211               	.LCFI6:
 212               		.cfi_def_cfa_offset 9
 213               		.cfi_offset 17, -8
 214 007e CF93      		push r28
 215               	.LCFI7:
 216               		.cfi_def_cfa_offset 10
 217               		.cfi_offset 28, -9
 218 0080 DF93      		push r29
 219               	.LCFI8:
 220               		.cfi_def_cfa_offset 11
 221               		.cfi_offset 29, -10
 222 0082 1F92      		push __zero_reg__
 223               	.LCFI9:
 224               		.cfi_def_cfa_offset 12
 225 0084 CDB7      		in r28,__SP_L__
 226 0086 DEB7      		in r29,__SP_H__
 227               	.LCFI10:
 228               		.cfi_def_cfa_register 28
 229               	/* prologue: function */
 230               	/* frame size = 1 */
 231               	/* stack size = 10 */
 232               	.L__stack_usage = 10
 233 0088 162F      		mov r17,r22
 234 008a E72E      		mov r14,r23
 235 008c F42E      		mov r15,r20
 236 008e 022F      		mov r16,r18
  47:twi.c         ****     twi_start();
 237               		.loc 1 47 0
 238 0090 8983      		std Y+1,r24
 239 0092 0E94 0000 		call twi_start
 240               	.LVL10:
 241               	.LBB36:
 242               	.LBB37:
  42:twi.c         ****     status = TWSR & 0xF8;
 243               		.loc 1 42 0
 244 0096 9091 B900 		lds r25,185
 245               	.LVL11:
 246 009a 987F      		andi r25,lo8(-8)
 247               	.LVL12:
 248               	.LBE37:
 249               	.LBE36:
  48:twi.c         ****     if(twi_status() != 0x08 && twi_status() != 0x10) {
 250               		.loc 1 48 0
 251 009c 8981      		ldd r24,Y+1
 252 009e 9830      		cpi r25,lo8(8)
 253 00a0 01F0      		breq .L20
 254               	.LBB38:
 255               	.LBB39:
  42:twi.c         ****     status = TWSR & 0xF8;
 256               		.loc 1 42 0
 257 00a2 9091 B900 		lds r25,185
 258               	.LVL13:
 259 00a6 987F      		andi r25,lo8(-8)
 260               	.LVL14:
 261               	.LBE39:
 262               	.LBE38:
 263               		.loc 1 48 0
 264 00a8 9031      		cpi r25,lo8(16)
 265 00aa 01F0      		breq .L20
 266               	.LBB40:
 267               	.LBB41:
  42:twi.c         ****     status = TWSR & 0xF8;
 268               		.loc 1 42 0
 269 00ac 8091 B900 		lds r24,185
 270               	.LVL15:
 271 00b0 887F      		andi r24,lo8(-8)
 272               	.LVL16:
 273               	.LBE41:
 274               	.LBE40:
  49:twi.c         ****         printf("Unexpected 1: %x\n", twi_status());
 275               		.loc 1 49 0
 276 00b2 1F92      		push __zero_reg__
 277 00b4 8F93      		push r24
 278 00b6 80E0      		ldi r24,lo8(.LC0)
 279 00b8 90E0      		ldi r25,hi8(.LC0)
 280               	.LVL17:
 281 00ba 00C0      		rjmp .L35
 282               	.LVL18:
 283               	.L20:
  50:twi.c         ****         twi_stop();
  51:twi.c         ****         return 1; // Unable to send start/repeated start
  52:twi.c         ****     }
  53:twi.c         ****     twi_write(addr<<1);
 284               		.loc 1 53 0
 285 00bc 880F      		lsl r24
 286 00be 0E94 0000 		call twi_write
 287               	.LVL19:
 288               	.LBB42:
 289               	.LBB43:
  42:twi.c         ****     status = TWSR & 0xF8;
 290               		.loc 1 42 0
 291 00c2 8091 B900 		lds r24,185
 292               	.LVL20:
 293 00c6 887F      		andi r24,lo8(-8)
 294               	.LVL21:
 295               	.LBE43:
 296               	.LBE42:
  54:twi.c         ****     if(twi_status() != 0x18) {
 297               		.loc 1 54 0
 298 00c8 8831      		cpi r24,lo8(24)
 299 00ca 01F4      		brne .L22
 300 00cc D12E      		mov r13,r17
 301 00ce A12E      		mov r10,r17
 302 00d0 BE2C      		mov r11,r14
 303 00d2 00C0      		rjmp .L23
 304               	.L22:
 305               	.LBB44:
 306               	.LBB45:
  42:twi.c         ****     status = TWSR & 0xF8;
 307               		.loc 1 42 0
 308 00d4 8091 B900 		lds r24,185
 309               	.LVL22:
 310 00d8 887F      		andi r24,lo8(-8)
 311               	.LVL23:
 312               	.LBE45:
 313               	.LBE44:
  55:twi.c         ****         printf("Unexpected 2: %x\n", twi_status());
 314               		.loc 1 55 0
 315 00da 1F92      		push __zero_reg__
 316 00dc 8F93      		push r24
 317 00de 80E0      		ldi r24,lo8(.LC1)
 318 00e0 90E0      		ldi r25,hi8(.LC1)
 319               	.LVL24:
 320               	.L35:
 321 00e2 9F93      		push r25
 322 00e4 8F93      		push r24
 323 00e6 0E94 0000 		call printf
 324               	.LVL25:
  56:twi.c         ****         twi_stop();
 325               		.loc 1 56 0
 326 00ea 0E94 0000 		call twi_stop
 327               	.LVL26:
  57:twi.c         ****         return 1; // ACK wasn't received
 328               		.loc 1 57 0
 329 00ee 0F90      		pop __tmp_reg__
 330 00f0 0F90      		pop __tmp_reg__
 331 00f2 0F90      		pop __tmp_reg__
 332 00f4 0F90      		pop __tmp_reg__
 333 00f6 00C0      		rjmp .L34
 334               	.LVL27:
 335               	.L23:
 336 00f8 1A2D      		mov r17,r10
 337 00fa 1D19      		sub r17,r13
 338               	.LVL28:
 339               	.LBB46:
  58:twi.c         ****     }
  59:twi.c         ****     for(uint8_t i=0;i<length;i++) {
 340               		.loc 1 59 0 discriminator 1
 341 00fc 1F15      		cp r17,r15
 342 00fe 00F4      		brsh .L36
 343               	.LVL29:
  60:twi.c         ****         twi_write(*(data++));
 344               		.loc 1 60 0
 345 0100 F501      		movw r30,r10
 346 0102 8191      		ld r24,Z+
 347               	.LVL30:
 348 0104 5F01      		movw r10,r30
 349 0106 0E94 0000 		call twi_write
 350               	.LVL31:
 351               	.LBB47:
 352               	.LBB48:
  42:twi.c         ****     status = TWSR & 0xF8;
 353               		.loc 1 42 0
 354 010a 8091 B900 		lds r24,185
 355               	.LVL32:
 356 010e 887F      		andi r24,lo8(-8)
 357               	.LVL33:
 358               	.LBE48:
 359               	.LBE47:
  61:twi.c         ****         if(twi_status() != 0x28) {
 360               		.loc 1 61 0
 361 0110 8832      		cpi r24,lo8(40)
 362 0112 01F0      		breq .L23
 363               	.LBB49:
 364               	.LBB50:
  42:twi.c         ****     status = TWSR & 0xF8;
 365               		.loc 1 42 0
 366 0114 8091 B900 		lds r24,185
 367               	.LVL34:
 368 0118 887F      		andi r24,lo8(-8)
 369               	.LVL35:
 370               	.LBE50:
 371               	.LBE49:
  62:twi.c         ****             printf("Unexpected 3(%d): %x\n", i, twi_status());
 372               		.loc 1 62 0
 373 011a 1F92      		push __zero_reg__
 374 011c 8F93      		push r24
 375 011e 1F92      		push __zero_reg__
 376 0120 1F93      		push r17
 377 0122 80E0      		ldi r24,lo8(.LC2)
 378 0124 90E0      		ldi r25,hi8(.LC2)
 379               	.LVL36:
 380 0126 9F93      		push r25
 381               	.LVL37:
 382 0128 8F93      		push r24
 383               	.LVL38:
 384 012a 0E94 0000 		call printf
 385               	.LVL39:
  63:twi.c         ****             twi_stop();
 386               		.loc 1 63 0
 387 012e 0E94 0000 		call twi_stop
 388               	.LVL40:
  64:twi.c         ****             return 1; // ACK wasn't received
 389               		.loc 1 64 0
 390 0132 0F90      		pop __tmp_reg__
 391 0134 0F90      		pop __tmp_reg__
 392 0136 0F90      		pop __tmp_reg__
 393 0138 0F90      		pop __tmp_reg__
 394 013a 0F90      		pop __tmp_reg__
 395 013c 0F90      		pop __tmp_reg__
 396               	.LVL41:
 397               	.L34:
 398 013e 81E0      		ldi r24,lo8(1)
 399 0140 00C0      		rjmp .L21
 400               	.LVL42:
 401               	.L36:
 402               	.LBE46:
  65:twi.c         ****         }
  66:twi.c         ****     }
  67:twi.c         ****     if(!repeat) twi_stop();
 403               		.loc 1 67 0
 404 0142 0111      		cpse r16,__zero_reg__
 405 0144 00C0      		rjmp .L26
 406               		.loc 1 67 0 is_stmt 0 discriminator 1
 407 0146 0E94 0000 		call twi_stop
 408               	.LVL43:
 409               	.L26:
  68:twi.c         ****     return 0;
 410               		.loc 1 68 0 is_stmt 1
 411 014a 80E0      		ldi r24,0
 412               	.LVL44:
 413               	.L21:
 414               	/* epilogue start */
  69:twi.c         **** }
 415               		.loc 1 69 0
 416 014c 0F90      		pop __tmp_reg__
 417 014e DF91      		pop r29
 418 0150 CF91      		pop r28
 419 0152 1F91      		pop r17
 420 0154 0F91      		pop r16
 421               	.LVL45:
 422 0156 FF90      		pop r15
 423               	.LVL46:
 424 0158 EF90      		pop r14
 425 015a DF90      		pop r13
 426 015c BF90      		pop r11
 427 015e AF90      		pop r10
 428 0160 0895      		ret
 429               		.cfi_endproc
 430               	.LFE13:
 432               		.section	.rodata.str1.1
 433               	.LC3:
 434 003a 556E 6578 		.string	"Unexpected 4: %x\n"
 434      7065 6374 
 434      6564 2034 
 434      3A20 2578 
 434      0A00 
 435               	.LC4:
 436 004c 556E 6578 		.string	"Unexpected 5: %x"
 436      7065 6374 
 436      6564 2035 
 436      3A20 2578 
 436      00
 437               	.LC5:
 438 005d 556E 6578 		.string	"Unexpected 6: %x\n"
 438      7065 6374 
 438      6564 2036 
 438      3A20 2578 
 438      0A00 
 439               	.LC6:
 440 006f 556E 6578 		.string	"Unexpected 7: %x\n"
 440      7065 6374 
 440      6564 2037 
 440      3A20 2578 
 440      0A00 
 441               		.text
 442               	.global	twi_receive
 444               	twi_receive:
 445               	.LFB14:
  70:twi.c         **** 
  71:twi.c         **** uint8_t twi_receive(uint8_t addr, uint8_t* data, uint8_t length, uint8_t repeat) {
 446               		.loc 1 71 0
 447               		.cfi_startproc
 448               	.LVL47:
 449 0162 AF92      		push r10
 450               	.LCFI11:
 451               		.cfi_def_cfa_offset 3
 452               		.cfi_offset 10, -2
 453 0164 BF92      		push r11
 454               	.LCFI12:
 455               		.cfi_def_cfa_offset 4
 456               		.cfi_offset 11, -3
 457 0166 DF92      		push r13
 458               	.LCFI13:
 459               		.cfi_def_cfa_offset 5
 460               		.cfi_offset 13, -4
 461 0168 EF92      		push r14
 462               	.LCFI14:
 463               		.cfi_def_cfa_offset 6
 464               		.cfi_offset 14, -5
 465 016a FF92      		push r15
 466               	.LCFI15:
 467               		.cfi_def_cfa_offset 7
 468               		.cfi_offset 15, -6
 469 016c 0F93      		push r16
 470               	.LCFI16:
 471               		.cfi_def_cfa_offset 8
 472               		.cfi_offset 16, -7
 473 016e 1F93      		push r17
 474               	.LCFI17:
 475               		.cfi_def_cfa_offset 9
 476               		.cfi_offset 17, -8
 477 0170 CF93      		push r28
 478               	.LCFI18:
 479               		.cfi_def_cfa_offset 10
 480               		.cfi_offset 28, -9
 481 0172 DF93      		push r29
 482               	.LCFI19:
 483               		.cfi_def_cfa_offset 11
 484               		.cfi_offset 29, -10
 485 0174 1F92      		push __zero_reg__
 486               	.LCFI20:
 487               		.cfi_def_cfa_offset 12
 488 0176 CDB7      		in r28,__SP_L__
 489 0178 DEB7      		in r29,__SP_H__
 490               	.LCFI21:
 491               		.cfi_def_cfa_register 28
 492               	/* prologue: function */
 493               	/* frame size = 1 */
 494               	/* stack size = 10 */
 495               	.L__stack_usage = 10
 496 017a 162F      		mov r17,r22
 497 017c E72E      		mov r14,r23
 498 017e 042F      		mov r16,r20
 499 0180 F22E      		mov r15,r18
  72:twi.c         ****     twi_start();
 500               		.loc 1 72 0
 501 0182 8983      		std Y+1,r24
 502 0184 0E94 0000 		call twi_start
 503               	.LVL48:
 504               	.LBB51:
 505               	.LBB52:
  42:twi.c         ****     status = TWSR & 0xF8;
 506               		.loc 1 42 0
 507 0188 9091 B900 		lds r25,185
 508               	.LVL49:
 509 018c 987F      		andi r25,lo8(-8)
 510               	.LVL50:
 511               	.LBE52:
 512               	.LBE51:
  73:twi.c         ****     if(twi_status() != 0x08 && twi_status() != 0x10) {
 513               		.loc 1 73 0
 514 018e 8981      		ldd r24,Y+1
 515 0190 9830      		cpi r25,lo8(8)
 516 0192 01F0      		breq .L38
 517               	.LBB53:
 518               	.LBB54:
  42:twi.c         ****     status = TWSR & 0xF8;
 519               		.loc 1 42 0
 520 0194 9091 B900 		lds r25,185
 521               	.LVL51:
 522 0198 987F      		andi r25,lo8(-8)
 523               	.LVL52:
 524               	.LBE54:
 525               	.LBE53:
 526               		.loc 1 73 0
 527 019a 9031      		cpi r25,lo8(16)
 528 019c 01F0      		breq .L38
 529               	.LBB55:
 530               	.LBB56:
  42:twi.c         ****     status = TWSR & 0xF8;
 531               		.loc 1 42 0
 532 019e 8091 B900 		lds r24,185
 533               	.LVL53:
 534 01a2 887F      		andi r24,lo8(-8)
 535               	.LVL54:
 536               	.LBE56:
 537               	.LBE55:
  74:twi.c         ****         printf("Unexpected 4: %x\n", twi_status());
 538               		.loc 1 74 0
 539 01a4 1F92      		push __zero_reg__
 540 01a6 8F93      		push r24
 541 01a8 80E0      		ldi r24,lo8(.LC3)
 542 01aa 90E0      		ldi r25,hi8(.LC3)
 543               	.LVL55:
 544 01ac 00C0      		rjmp .L53
 545               	.LVL56:
 546               	.L38:
  75:twi.c         ****         twi_stop();
  76:twi.c         ****         return 1; // Unable to send start/repeated start
  77:twi.c         ****     }
  78:twi.c         ****     twi_write((addr<<1) | 0x01);
 547               		.loc 1 78 0
 548 01ae 880F      		lsl r24
 549 01b0 8160      		ori r24,lo8(1)
 550 01b2 0E94 0000 		call twi_write
 551               	.LVL57:
 552               	.LBB57:
 553               	.LBB58:
  42:twi.c         ****     status = TWSR & 0xF8;
 554               		.loc 1 42 0
 555 01b6 8091 B900 		lds r24,185
 556               	.LVL58:
 557 01ba 887F      		andi r24,lo8(-8)
 558               	.LVL59:
 559               	.LBE58:
 560               	.LBE57:
  79:twi.c         ****     if(twi_status() != 0x40) {
 561               		.loc 1 79 0
 562 01bc 8034      		cpi r24,lo8(64)
 563 01be 01F4      		brne .L40
 564 01c0 D12E      		mov r13,r17
 565 01c2 A12E      		mov r10,r17
 566 01c4 BE2C      		mov r11,r14
 567               	.LBB59:
  80:twi.c         ****         printf("Unexpected 5: %x", twi_status());
  81:twi.c         ****         twi_stop();
  82:twi.c         ****         return 1; // ACK wasn't received
  83:twi.c         ****     }
  84:twi.c         ****     for(uint8_t i=0;i<length-1;i++) {
 568               		.loc 1 84 0
 569 01c6 10E0      		ldi r17,0
 570 01c8 0150      		subi r16,1
 571 01ca 1109      		sbc r17,__zero_reg__
 572               	.LVL60:
 573 01cc 00C0      		rjmp .L41
 574               	.LVL61:
 575               	.L40:
 576               	.LBE59:
 577               	.LBB64:
 578               	.LBB65:
  42:twi.c         ****     status = TWSR & 0xF8;
 579               		.loc 1 42 0
 580 01ce 8091 B900 		lds r24,185
 581               	.LVL62:
 582 01d2 887F      		andi r24,lo8(-8)
 583               	.LVL63:
 584               	.LBE65:
 585               	.LBE64:
  80:twi.c         ****         printf("Unexpected 5: %x", twi_status());
 586               		.loc 1 80 0
 587 01d4 1F92      		push __zero_reg__
 588 01d6 8F93      		push r24
 589 01d8 80E0      		ldi r24,lo8(.LC4)
 590 01da 90E0      		ldi r25,hi8(.LC4)
 591               	.LVL64:
 592 01dc 00C0      		rjmp .L53
 593               	.LVL65:
 594               	.L41:
 595 01de 8A2D      		mov r24,r10
 596 01e0 8D19      		sub r24,r13
 597               	.LBB66:
 598               		.loc 1 84 0 discriminator 1
 599 01e2 90E0      		ldi r25,0
 600 01e4 8017      		cp r24,r16
 601 01e6 9107      		cpc r25,r17
 602 01e8 04F4      		brge .L54
 603               	.LVL66:
  85:twi.c         ****         *(data++) = twi_read(TWI_ACK);
 604               		.loc 1 85 0
 605 01ea 81E0      		ldi r24,lo8(1)
 606 01ec 0E94 0000 		call twi_read
 607               	.LVL67:
 608 01f0 F501      		movw r30,r10
 609 01f2 8193      		st Z+,r24
 610               	.LVL68:
 611 01f4 5F01      		movw r10,r30
 612               	.LVL69:
 613               	.LBB60:
 614               	.LBB61:
  42:twi.c         ****     status = TWSR & 0xF8;
 615               		.loc 1 42 0
 616 01f6 8091 B900 		lds r24,185
 617               	.LVL70:
 618 01fa 887F      		andi r24,lo8(-8)
 619               	.LVL71:
 620               	.LBE61:
 621               	.LBE60:
  86:twi.c         ****         if(twi_status() != 0x50) {
 622               		.loc 1 86 0
 623 01fc 8035      		cpi r24,lo8(80)
 624 01fe 01F0      		breq .L41
 625               	.LBB62:
 626               	.LBB63:
  42:twi.c         ****     status = TWSR & 0xF8;
 627               		.loc 1 42 0
 628 0200 8091 B900 		lds r24,185
 629               	.LVL72:
 630 0204 887F      		andi r24,lo8(-8)
 631               	.LVL73:
 632               	.LBE63:
 633               	.LBE62:
  87:twi.c         ****             printf("Unexpected 6: %x\n", twi_status());
 634               		.loc 1 87 0
 635 0206 1F92      		push __zero_reg__
 636 0208 8F93      		push r24
 637 020a 80E0      		ldi r24,lo8(.LC5)
 638 020c 90E0      		ldi r25,hi8(.LC5)
 639               	.LVL74:
 640 020e 00C0      		rjmp .L53
 641               	.LVL75:
 642               	.L54:
 643               	.LBE66:
  88:twi.c         ****             twi_stop();
  89:twi.c         ****             return 1; // Data wasn't received
  90:twi.c         ****         }
  91:twi.c         ****     }
  92:twi.c         ****     *(data++) = twi_read(TWI_NACK);
 644               		.loc 1 92 0
 645 0210 80E0      		ldi r24,0
 646 0212 0E94 0000 		call twi_read
 647               	.LVL76:
 648 0216 F501      		movw r30,r10
 649 0218 8083      		st Z,r24
 650               	.LBB67:
 651               	.LBB68:
  42:twi.c         ****     status = TWSR & 0xF8;
 652               		.loc 1 42 0
 653 021a 8091 B900 		lds r24,185
 654               	.LVL77:
 655 021e 887F      		andi r24,lo8(-8)
 656               	.LVL78:
 657               	.LBE68:
 658               	.LBE67:
  93:twi.c         ****     if(twi_status() != 0x58) {
 659               		.loc 1 93 0
 660 0220 8835      		cpi r24,lo8(88)
 661 0222 01F0      		breq .L44
 662               	.LBB69:
 663               	.LBB70:
  42:twi.c         ****     status = TWSR & 0xF8;
 664               		.loc 1 42 0
 665 0224 8091 B900 		lds r24,185
 666               	.LVL79:
 667 0228 887F      		andi r24,lo8(-8)
 668               	.LVL80:
 669               	.LBE70:
 670               	.LBE69:
  94:twi.c         ****         printf("Unexpected 7: %x\n", twi_status());
 671               		.loc 1 94 0
 672 022a 1F92      		push __zero_reg__
 673 022c 8F93      		push r24
 674 022e 80E0      		ldi r24,lo8(.LC6)
 675 0230 90E0      		ldi r25,hi8(.LC6)
 676               	.LVL81:
 677               	.L53:
 678 0232 9F93      		push r25
 679 0234 8F93      		push r24
 680 0236 0E94 0000 		call printf
 681               	.LVL82:
  95:twi.c         ****         twi_stop();
 682               		.loc 1 95 0
 683 023a 0E94 0000 		call twi_stop
 684               	.LVL83:
  96:twi.c         ****         return 1; // Data wasn't received
 685               		.loc 1 96 0
 686 023e 0F90      		pop __tmp_reg__
 687 0240 0F90      		pop __tmp_reg__
 688 0242 0F90      		pop __tmp_reg__
 689 0244 0F90      		pop __tmp_reg__
 690 0246 81E0      		ldi r24,lo8(1)
 691 0248 00C0      		rjmp .L39
 692               	.LVL84:
 693               	.L44:
  97:twi.c         ****     }
  98:twi.c         ****     if(!repeat) twi_stop();
 694               		.loc 1 98 0
 695 024a F110      		cpse r15,__zero_reg__
 696 024c 00C0      		rjmp .L45
 697               		.loc 1 98 0 is_stmt 0 discriminator 1
 698 024e 0E94 0000 		call twi_stop
 699               	.LVL85:
 700               	.L45:
  99:twi.c         ****     return 0;
 701               		.loc 1 99 0 is_stmt 1
 702 0252 80E0      		ldi r24,0
 703               	.LVL86:
 704               	.L39:
 705               	/* epilogue start */
 100:twi.c         **** }
 706               		.loc 1 100 0
 707 0254 0F90      		pop __tmp_reg__
 708 0256 DF91      		pop r29
 709 0258 CF91      		pop r28
 710 025a 1F91      		pop r17
 711 025c 0F91      		pop r16
 712 025e FF90      		pop r15
 713               	.LVL87:
 714 0260 EF90      		pop r14
 715 0262 DF90      		pop r13
 716 0264 BF90      		pop r11
 717 0266 AF90      		pop r10
 718 0268 0895      		ret
 719               		.cfi_endproc
 720               	.LFE14:
 722               	.Letext0:
 723               		.file 2 "/usr/lib/avr/include/stdio.h"
 724               		.file 3 "/usr/lib/avr/include/stdint.h"
DEFINED SYMBOLS
                            *ABS*:0000000000000000 twi.c
     /tmp/ccPhncbQ.s:2      *ABS*:000000000000003e __SP_H__
     /tmp/ccPhncbQ.s:3      *ABS*:000000000000003d __SP_L__
     /tmp/ccPhncbQ.s:4      *ABS*:000000000000003f __SREG__
     /tmp/ccPhncbQ.s:5      *ABS*:0000000000000000 __tmp_reg__
     /tmp/ccPhncbQ.s:6      *ABS*:0000000000000001 __zero_reg__
     /tmp/ccPhncbQ.s:12     .text:0000000000000000 twi_init
     /tmp/ccPhncbQ.s:39     .text:0000000000000018 twi_start
     /tmp/ccPhncbQ.s:63     .text:0000000000000028 twi_stop
     /tmp/ccPhncbQ.s:87     .text:0000000000000038 twi_write
     /tmp/ccPhncbQ.s:116    .text:000000000000004c twi_read
     /tmp/ccPhncbQ.s:153    .text:0000000000000068 twi_status
     /tmp/ccPhncbQ.s:181    .text:0000000000000070 twi_send
     /tmp/ccPhncbQ.s:444    .text:0000000000000162 twi_receive

UNDEFINED SYMBOLS
printf
__do_copy_data
